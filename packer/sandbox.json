{
  "min_packer_version": "1.5.6",
  "variables": {
    "username": "methridge",
    "project_id": "methridge-sandbox",
    "zone": "us-central1-f",
    "premium_bucket": "sandbox-bin",
    "consul_ent": "true",
    "consul_premium": "false",
    "consul_version": "",
    "consul_template_version": "",
    "envconsul_version": "",
    "nomad_ent": "true",
    "nomad_premium": "false",
    "nomad_version": "",
    "terraform_version": "",
    "vault_ent": "true",
    "vault_premium": "false",
    "vault_version": ""
  },
  "builders": [
    {
      "name": "sandbox-image",
      "type": "googlecompute",
      "image_name": "{{user `username`}}-sandbox",
      "image_family": "{{user `username`}}-sandbox",
      "project_id": "{{user `project_id`}}",
      "source_image_family": "ubuntu-2004-lts",
      "zone": "{{user `zone`}}",
      "ssh_username": "ubuntu"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "inline": ["mkdir /tmp/files"]
    },
    {
      "type": "file",
      "source": "../modules/region-hashistack/bucket-files/",
      "destination": "/tmp/files"
    },
    {
      "type": "shell",
      "script": "scripts/install-hashistack.sh",
      "environment_vars": [
        "PREMIUM_BUCKET={{user `premium_bucket`}}",
        "CONSUL_ENT={{user `consul_ent`}}",
        "CONSUL_PREMIUM={{user `consul_premium`}}",
        "CONSUL_VERSION={{user `consul_version`}}",
        "NOMAD_ENT={{user `nomad_ent`}}",
        "NOMAD_PREMIUM={{user `nomad_premium`}}",
        "NOMAD_VERSION={{user `nomad_version`}}",
        "VAULT_ENT={{user `vault_ent`}}",
        "VAULT_PREMIUM={{user `vault_premium`}}",
        "VAULT_VERSION={{user `vault_version`}}",
        "CONSUL_TEMPLATE_VERSION={{user `consul_template_version`}}",
        "ENVCONSUL_VERSION={{user `envconsul_version`}}",
        "TERRAFORM_VERSION={{user `terraform_version`}}"
      ],
      "pause_before": "5s",
      "max_retries": 5
    }
  ]
}
